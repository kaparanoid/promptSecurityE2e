(()=>{"use strict";var e={405:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=o(427),i=new Map([["Code Detector","code source"]]);let a=!1,s=null;const l=()=>n(void 0,void 0,void 0,(function*(){let e=document.createElement("script");if(e.src=r.browserObj.runtime.getURL("bundle/script.bundle.js"),e.id="ps_script",e.dataset){let{corporateDomains:t,inspectFiles:o,inspectResponses:n,blockChatGPTTraining:i,blockChatGPTMemory:a,blockChatGPTShare:s}=yield r.browserObj.storage.sync.get(["corporateDomains","inspectFiles","inspectResponses","blockChatGPTTraining","blockChatGPTMemory","blockChatGPTShare"]);e.dataset.inspect_drive=t&&t.length>0?"true":"false",e.dataset.inspect_files=!0===o?"true":"false",e.dataset.block_chat_sharing=s,e.dataset.inspect_responses=!0===n?"true":"false",e.dataset.block_chatgpt_training=!0===i?"true":"false",e.dataset.block_chatgpt_memory=!0===a?"true":"false",e.dataset.ext_id=r.browserObj.runtime.id}e.onload=function(){e.remove()},(document.head||document.documentElement).appendChild(e)}));window.addEventListener("message",(function(e){return n(this,void 0,void 0,(function*(){if(e.source!==window||!e.data||"FROM_PAGE"!==e.data.type)return;let t=yield r.browserObj.runtime.sendMessage(e.data.message);window.postMessage({type:"FROM_BACKGROUND",messageId:e.data.messageId,response:t},"*")}))}));function c(e){const t=function(e){return console.log("Blocked user attempt to drag files to ChatGPT"),e.preventDefault(),e.stopPropagation(),!1};["drag","dragover","dragend","dragenter","drop","dragstart","dragleave"].forEach((function(e){document.addEventListener(e,t,!0)}));const o=document.querySelector('input[type="file"]');if(o){const t=document.querySelectorAll('button[class="btn relative btn-secondary btn-small"]');for(const e of t)"Connect"==e.innerText&&(e.onclick=function(e){return e.preventDefault(),e.stopPropagation(),console.log("Blocked user attempt to connect file shares to ChatGPT"),alert("Blocked by your Administrator"),!1});const n=o.parentNode;"all"==e&&(o.disabled=!0);for(const t of n.getElementsByTagName("button"))t.onclick=function(t){return t.preventDefault(),t.stopPropagation(),"all"==e?(console.log("Blocked user attempt click the file upload button in ChatGPT"),alert("Blocked by your Administrator")):o.click(),!1}}}function d(){return n(this,void 0,void 0,(function*(){let{blockChatGPTTraining:e,blockChatGPTMemory:t,enforceChatGPTWorkspace:o,blockChatGPTFiles:i,enforceChatGPTTempChat:a,blockPersonalAccounts:s}=yield r.browserObj.storage.sync.get(["blockChatGPTTraining","blockChatGPTMemory","enforceChatGPTWorkspace","blockChatGPTFiles","enforceChatGPTTempChat","blockPersonalAccounts"]);(e||t||o||i&&"off"!=i||a||s&&"off"!=s)&&setInterval((function(){e&&n(void 0,void 0,void 0,(function*(){const e=document.querySelector('button[aria-label="Improve the model for everyone"]');e&&"false"==e.ariaChecked&&(e.onclick=function(e){return e.preventDefault(),e.stopPropagation(),console.log("Blocked user attempt to enable chat training in ChatGPT"),alert("Blocked by your Administrator"),!1})})),t&&n(void 0,void 0,void 0,(function*(){const e=document.querySelector('button[aria-label="Memory"]');e&&"false"==e.ariaChecked&&(e.onclick=function(e){return e.preventDefault(),e.stopPropagation(),console.log("Blocked user attempt to enable chat memory in ChatGPT"),alert("Blocked by your Administrator"),!1})})),i&&"off"!=i&&c(i);const r=document.cookie.indexOf("_account=personal")>=0;r&&"files"==s&&c("all"),(o||r&&"all"==s)&&(e=>{n(void 0,void 0,void 0,(function*(){if(document.querySelector('button[data-testid="login-button"]')||document.cookie.indexOf(`_account=${e}`)<0){c("all");const e=document.querySelector('button[data-testid="send-button"]');e&&(e.style.display="none");const t=document.getElementById("prompt-textarea");if(t){t.contentEditable="false",t.style.display="none";const e=t.parentElement.getElementsByTagName("textarea")[0];e&&(e.disabled=!0,e.style.display="block",e.placeholder="Blocked by your Administrator")}}}))})(o||"corporate_account"),a&&function(){const e=document.querySelector('button[aria-label="Temporary"]');e&&(e.onclick=function(e){return e.preventDefault(),e.stopPropagation(),console.log("Blocked user attempt to disable temporary chat in ChatGPT"),alert("Blocked by your Administrator"),!1}),location.href.includes("temporary-chat=true")||(console.log("Enforcing temporary chat in ChatGPT"),location.href.includes("?")?location.href+="&temporary-chat=true":location.href+="?temporary-chat=true")}()}),500)}))}function u(e,t,o,i=null){const s=document.createElement("div");s.style.all="initial",document.body.appendChild(s),a=!0;const l=s.attachShadow({mode:"open"}),c=document.createElement("style");c.textContent=e,l.appendChild(c);const d=document.createElement("div"),u=(new DOMParser).parseFromString(t,"text/html");d.appendChild(u.body),l.appendChild(d),o(l);const m=l.querySelector("#closeButton");m&&m.addEventListener("click",(()=>{s.remove(),a=!1}));const f=l.querySelector("#accessButton");f&&i&&f.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){s.remove(),a=!1,yield r.browserObj.runtime.sendMessage(i)}))))}function m(e,t,o,n){const r=e.getElementById("arrow-back"),i=e.getElementById("arrow-forward");if(n!==o){const a=e.getElementById(`arrow-circle-${n}`),s=e.getElementById(`arrow-circle-${o}`);a.style.backgroundColor="#DDDEE3",s.style.backgroundColor="#415FFF",0!==o&&(r.classList.add("arrow"),r.classList.remove("arrow-disabled")),o!==t-1&&(i.classList.add("arrow"),i.classList.remove("arrow-disabled")),0===o&&(r.classList.remove("arrow"),r.classList.add("arrow-disabled")),o===t-1&&(i.classList.remove("arrow"),i.classList.add("arrow-disabled"))}}function f(e,t){const o=e.getElementById("violation-message-text");let n="sensitive data";i.has(t.violationType)&&(n=i.get(t.violationType)),o.innerText=`We noticed that you were trying to send ${n}`,e.querySelectorAll(".violation-info-content-frame").forEach((e=>e.remove()));const r=e.getElementById("violation-info-frame");for(let e=0;e<t.values.length;e++){const o=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");o.className="violation-info-content-frame",o.id=`violation-info-content-frame-${e}`,n.className="violation-info-content-title",n.id=`violation-info-content-title-${e}`,n.innerText=y(t.values[e].entityType),i.className="violation-info-content",i.id=`violation-info-content-${e}`,i.innerText=t.values[e].entity,o.appendChild(n),o.appendChild(i),r.appendChild(o)}}!function(){n(this,void 0,void 0,(function*(){"chatgpt.com"==location.hostname?(yield l(),yield d()):"app.writer.com"==location.hostname||"inference.cerebras.ai"==location.hostname||"www.vidu.studio"==location.hostname||"bot.ivy.ai"==location.hostname||"chat.lmsys.org"==location.hostname||location.hostname.endsWith("groq.com")||"zapier.com"==location.hostname||"drive.google.com"==location.hostname||"www.dropbox.com"==location.hostname||"www.icloud.com"==location.hostname||"onedrive.live.com"==location.hostname||location.hostname.endsWith(".console.aws.amazon.com")||"wetransfer.com"==location.hostname||location.hostname.endsWith(".sharefile.eu")?r.browserObj.runtime.sendMessage({type:"shouldInjectScript",href:location.href,hostname:location.hostname}):window.addEventListener("load",(()=>{r.browserObj.runtime.sendMessage({type:"shouldInjectScript",href:location.href,hostname:location.hostname})}))}))}();const g=(e,t)=>o=>n(void 0,void 0,void 0,(function*(){const{customImage:n}=yield r.browserObj.storage.local.get(["customImage"]),i=yield r.browserObj.storage.sync.get(["customMessageCoachAwareness","customGuidelinesLink"]),a=[...e.values()],s=a.length;let l=i.customMessageCoachAwareness,c=i.customGuidelinesLink,d=0;if(n){const e=o.getElementById("header-image");e.src=`${n.replace(/ /g,"+")}`,e.style.display="block"}if(o.getElementById("powered-by-logo").src=r.browserObj.runtime.getURL("/images/prompt_logo.png"),l&&""!==l.trim()){const e=o.getElementById("customize-text");o.getElementById("custom-message").innerText=l.trim(),e.style.display="flex"}if(c&&""!==c.trim()){const e=o.getElementById("guidelines-box");e.innerHTML=`For more information <a href="${c.trim()}" target="_blank">visit the guidelines</a>`,e.style.display="block"}!function(e,t,o){const n=e.getElementById("violations-meta-title"),r=e.getElementById("arrows-container"),i=e.getElementById("arrow-circles"),a=o?" - your request was blocked":"";if(1===t)r.style.display="none",n.innerText="1 violation found"+a;else if(t>1){n.innerText=`${t} violations found`+a;for(let e=0;e<t;e++){const t=document.createElement("div");t.className="arrow-circle",t.id=`arrow-circle-${e}`,t.style.backgroundColor=0===e?"#415FFF":"#DDDEE3",i.appendChild(t),r.style.display="flex"}t>45&&(i.style.display="none");const o=e.getElementById("arrow-back"),s=e.getElementById("arrow-forward");o.classList.remove("arrow"),o.classList.add("arrow-disabled"),s.classList.add("arrow"),s.classList.remove("arrow-disabled")}}(o,s,t),f(o,a[0]);o.getElementById("arrow-back-button").addEventListener("click",(()=>{0!==d&&(d-=1,f(o,a[d]),m(o,s,d,d+1))}));o.getElementById("arrow-forward-button").addEventListener("click",(()=>{d!==s-1&&(d+=1,f(o,a[d]),m(o,s,d,d-1))}))}));function y(e){const t=["US","UK","ES","IT","SG","AU","SSN","IBAN","IP","UUID","ITIN","NRP","ABN","ACN","TFN","NRIC","FIN","NHS","NIF","VAT"],o=["RE"];for(var n=e.replace(/_/g," ").split(" "),r=0;r<n.length;r++){if(o.includes(n[r])){n.splice(r,1),r--;break}t.includes(n[r])||(n[r]=n[r].charAt(0).toUpperCase()+n[r].slice(1).toLowerCase())}return n.join(" ")}function h(e){return n(this,void 0,void 0,(function*(){let t=yield fetch(r.browserObj.runtime.getURL("style/blockModal.css"));const o=yield t.text();t=yield fetch(r.browserObj.runtime.getURL("html/blockModal.html"));const i=yield t.text(),a=e.domain,s=e.allowBypass,l=s?{type:"aiChatBlockMessageBypass",domain:a}:null;u(o,i,((e,t,o)=>i=>n(void 0,void 0,void 0,(function*(){const{customImage:n}=yield r.browserObj.storage.local.get(["customImage"]),a=yield r.browserObj.storage.sync.get(["customMessageBlockPage","customGuidelinesLink"]);let s=a.customMessageBlockPage,l=a.customGuidelinesLink;i.getElementById("powered-by-logo").src=r.browserObj.runtime.getURL("/images/prompt_logo.png");const c=i.getElementById("message-title");if("rule"===t&&null!==e?c.innerText=`The AI component in the domain ${e} was blocked by your administrator`:"policy"===t&&(c.innerText="Your request has been blocked for violating policies set by your administrator"),n){const e=i.getElementById("header-image");e.src=`${n.replace(/ /g,"+")}`,e.style.display="block"}if("rule"===t&&s&&""!==s.trim()){const e=i.getElementById("custom-message");e.innerText=s.trim(),e.style.display="block"}if(l&&""!==l.trim()){const e=i.getElementById("guidelines");e.innerHTML=`For more information <a href="${l.trim()}" target="_blank">visit the guidelines</a>`,e.style.display="block"}const d=i.getElementById("accessButton"),u=i.getElementById("bypass-message");o?(d.style.display="block",u.style.display="block"):(d.style.display="none",u.style.display="none")})))(a,e.blockReason,s),l)}))}r.browserObj.runtime.onMessage.addListener((function(e,t,o){return n(this,void 0,void 0,(function*(){if("shouldInjectScriptResponse"==e.type)e.shouldInject&&(yield l());else if("downloadLogs"===e.type)yield function(){return n(this,void 0,void 0,(function*(){const e=yield(0,r.getLogs)(),t=new Blob([e.join("\n")],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download="prompt_security_extension_debug_logs.txt",o.click()}))}();else if("getReferrerDomain"===e.type)o(document.referrer);else if("Modal"==e.type){if(a)return void console.log(`Got request to show ${e.modalType} on ${location.href} but modal is already open`);if("educationMessage"===e.modalType){const t=JSON.stringify(e.content);s!==t?(console.log(`Showing education message for ${location.href}, blocked=${e.blocked}`),function(e,t){n(this,void 0,void 0,(function*(){let o=yield fetch(r.browserObj.runtime.getURL("style/educationModal.css"));const n=yield o.text();o=yield fetch(r.browserObj.runtime.getURL("html/educationModal.html"));const i=yield o.text(),a=new Map(Object.entries(e));u(n,i,g(a,t))}))}(e.content,e.blocked),s=t):console.log(`Not showing education message on ${location.href} as it is the same as the last one`)}else"aiChatBlockMessage"===e.modalType&&(console.log(`Showing AI chat block message for ${location.href}`),h(e.content))}}))}))},427:function(e,t){var o,n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getDomain=t.getManagedSettings=t.isDomainMatched=t.getLogs=t.clearLogsInStorage=t.saveLogsToStorage=t.addLog=t.setBrowserName=t.browserName=t.browserObj=void 0,t.browserObj="undefined"==typeof browser?chrome:browser,t.browserName=function(){var e=navigator.userAgent.toLowerCase();if(navigator.brave||-1!==e.indexOf("brave"))return"Brave";if(-1!==e.indexOf("opera")||-1!==e.indexOf("opr"))return"Opera";if(-1!==e.indexOf("edge")||-1!==e.indexOf("edg/"))return"Edge";if(-1!==e.indexOf("whale"))return"Whale";if(-1!==e.indexOf("firefox"))return"Firefox";if(-1!==e.indexOf("vivaldi"))return"Vivaldi";if(-1!==e.indexOf("talon"))return"Talon";if(-1!==e.indexOf("island"))return"Island";if(-1!==e.indexOf("chrome"))return"Chrome";if(-1!==e.indexOf("safari"))return"Safari";return"Unknown"}(),"Whale"==t.browserName&&(t.browserObj.identity=null),t.setBrowserName=function(e){t.browserName=e},null!==(o=AbortSignal.timeout)&&void 0!==o||(AbortSignal.timeout=function(e){const t=new AbortController;return setTimeout((()=>t.abort()),e),t.signal});let r=[],i=[],a=Date.now();if("Safari"==t.browserName){const e=t.browserObj.storage.sync.set;t.browserObj.storage.sync.set=function(o){let n=[];for(const e in o)null===o[e]&&(n.push(e),delete o[e]);return n.length>0&&t.browserObj.storage.sync.remove(n),e.apply(t.browserObj.storage.sync,[o])}}const s=console.log;function l(e,t){return n(this,void 0,void 0,(function*(){const o=Date.now(),n=`${(new Date).toLocaleString()} - ${e.split(".")[0].padEnd(11)} ${t}`;s(n),r.push(n),i.push(n),r.length>1e3&&r.shift(),(o-a>=6e4||i.length>=50)&&(yield c())}))}function c(){return n(this,void 0,void 0,(function*(){i.length>0&&(yield t.browserObj.storage.local.set({debugLogs:r})),i=[],a=Date.now()}))}console.log=function(...e){let o="";const n=e.toString();try{const e=(new Error).stack.split("\n"),t=e[0].startsWith("Error")?e[2]:e[1];o=t.match(/\/[^/]+\/([^/]+:\d+):\d+/)[1]}catch(e){}if(location.toString().includes("background"))l(o,n);else{const e={type:"addLog",location:o,log:n};t.browserObj.runtime.sendMessage(e).catch((()=>{}))}},t.addLog=l,t.saveLogsToStorage=c,t.clearLogsInStorage=function(){return n(this,void 0,void 0,(function*(){r=[],yield t.browserObj.storage.local.set({debugLogs:r}),i=[],a=Date.now()}))},t.getLogs=function(){return n(this,void 0,void 0,(function*(){const{debugLogs:e}=yield t.browserObj.storage.local.get(["debugLogs"]);return r=e||[],r}))},t.isDomainMatched=function(e,t){for(const o of t)if(e==o||(null==e?void 0:e.endsWith("."+o)))return!0;return!1};let d,u=!1;function m(e){return n(this,void 0,void 0,(function*(){u||(yield function(){return n(this,void 0,void 0,(function*(){return new Promise((e=>{t.browserObj.runtime.sendNativeMessage("dummy.application.id",{type:"settings"},(function(t){d=t.settings,e(d)}))}))}))}(),u=!0);return Object.keys(d).filter((t=>e.includes(t))).reduce(((e,t)=>(e[t]=d[t],e)),{})}))}t.getManagedSettings=function(e){return n(this,void 0,void 0,(function*(){try{if("Safari"==t.browserName)return yield m(e);if(t.browserObj.storage.managed)return(yield t.browserObj.storage.managed.get(e))||{}}catch(e){console.log(e)}return{}}))},t.getDomain=function(e,t=void 0){let o="";try{e&&e.includes("://")&&(o=new URL(e).hostname,!0!==t||o.startsWith("www.")?!1===t&&o.startsWith("www.")&&(o=o.substring(4)):o="www."+o)}catch(e){console.log(e)}return o}}},t={};(function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports})(405)})();