(()=>{"use strict";var e={6:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(427);function r(e,t){const n=t?"solid 1px rgba(232, 78, 78, 1)":"solid 1px rgba(50, 162, 119, 1)",o=t?"rgba(232, 78, 78, 0.05)":"rgba(50, 162, 119, 0.05)",i=t?"rgba(232, 78, 78, 1)":"rgba(50, 162, 119, 1)",r=t?"rgba(232, 78, 78, 1)":"rgba(50, 162, 119, 1)";e.onmouseenter=()=>{e.style.border=n,e.style.backgroundColor=i,e.style.color="rgba(255, 255, 255, 1)"},e.onmouseleave=()=>{e.style.border=n,e.style.backgroundColor=o,e.style.color=r}}function s(e,t,n){return o(this,void 0,void 0,(function*(){if(!t||!n)return;const s=yield i.browserObj.storage.sync.get(["workProfileDomain","isExtensionDisabled","globalSettingsCanBypassInspection"]);yield i.browserObj.runtime.sendMessage({type:"getSiteActionConfig",domain:e},(function(a){var l;return o(this,void 0,void 0,(function*(){const{userBypassedInspectedDomains:d,inspectionBypassPrevented:c,inspectionBypassUponApproval:u,ignoredDomains:y,domainActions:g,userInfo:b}=a,v=(null==g?void 0:g.canBypassInspection)||s.globalSettingsCanBypassInspection;(null==b?void 0:b.email)&&(document.getElementById("user").style.display="flex",document.getElementById("email").innerText=b.email);let f={email:null};(null===(l=i.browserObj.identity)||void 0===l?void 0:l.getProfileUserInfo)&&(f=yield i.browserObj.identity.getProfileUserInfo({accountStatus:i.browserObj.identity.AccountStatus.ANY})),s.isExtensionDisabled?(n.style.display="block",n.textContent="Disabled by admin",t.style.display="none"):!s.workProfileDomain||f.email&&f.email.endsWith(s.workProfileDomain)?c&&(0,i.isDomainMatched)(e,c)||y&&(0,i.isDomainMatched)(e,y)?t.style.display="none":u&&(0,i.isDomainMatched)(e,u)&&!(0,i.isDomainMatched)(e,d.map((e=>e.domain)))?(t.style.display="block",t.textContent="Request Bypass for this site",t.addEventListener("click",(()=>o(this,void 0,void 0,(function*(){t.style.display="none";const o={type:"protectionBypassApprovalRequest",reason:"",domain:e};yield i.browserObj.runtime.sendMessage(o),n.style.display="block",n.textContent="Bypass request was sent for approval by your admin"}))))):"Allow"==v&&(t.style.display="block",d.length>0&&(0,i.isDomainMatched)(e,d.map((e=>e.domain)))&&(t.textContent="Enable protection for this site",t.style.backgroundColor="rgba(50, 162, 119, 0.05)",t.style.color="rgba(50, 162, 119, 1)",t.style.border="solid 1px rgba(50, 162, 119, 1)",r(t,!1),yield function(e){return o(this,void 0,void 0,(function*(){const t={type:"setBadge",domain:e};yield i.browserObj.runtime.sendMessage(t)}))}(e)),t.addEventListener("click",(()=>o(this,void 0,void 0,(function*(){var o;let s;(null===(o=t.textContent)||void 0===o?void 0:o.startsWith("Enable"))?(console.log(`user enabled protection for ${e}`),t.textContent="Bypass protection for this site",t.style.backgroundColor="rgba(232, 78, 78, 0.05)",t.style.color="rgba(232, 78, 78, 1)",t.style.border="solid 1px rgba(232, 78, 78, 1)",s=!0,r(t,s)):(console.log(`user disabled protection for ${e}`),t.textContent="Enable protection for this site",t.style.backgroundColor="rgba(50, 162, 119, 0.05)",t.style.color="rgba(50, 162, 119, 1)",t.style.border="solid 1px rgba(50, 162, 119, 1)",s=!1,r(t,s)),n.style.display="block",n.textContent="Reload page to apply changes";const a={type:"ProtectionDomainEnableModeChange",isEnabled:s,domain:e};yield i.browserObj.runtime.sendMessage(a)}))))):(n.style.display="block",n.textContent="Disabled for non-work profile",t.style.display="none")}))}))}))}document.addEventListener("DOMContentLoaded",(()=>o(void 0,void 0,void 0,(function*(){var e,t,n,r,a;const l=yield(0,i.getManagedSettings)(["apiDomain","apiKey"]),d=yield i.browserObj.storage.sync.get(["apiDomain","apiKey"]),c=(yield i.browserObj.tabs.query({active:!0,currentWindow:!0}))[0],u=(0,i.getDomain)(c.url),y=document.querySelector("#saveButton"),g=document.querySelector("#apiDomain");l.apiDomain?(document.getElementById("apiDomainDiv").style.display="none",g.value=null!==(t=l.apiDomain)&&void 0!==t?t:"",g.disabled=!0):(document.getElementById("apiDomainDiv").style.display="flex",g.value=null!==(e=d.apiDomain)&&void 0!==e?e:""),g.addEventListener("input",(()=>o(void 0,void 0,void 0,(function*(){y.style.display="block"}))));const b=document.querySelector("#apiKey");l.apiKey||l.apiDomain?(document.getElementById("apiKeyDiv").style.display="none",b.value=null!==(r=l.apiKey)&&void 0!==r?r:"",b.disabled=!0):(document.getElementById("apiKeyDiv").style.display="flex",b.value=null!==(n=d.apiKey)&&void 0!==n?n:""),b.addEventListener("input",(()=>{y.style.display="block"})),y.addEventListener("click",(()=>o(void 0,void 0,void 0,(function*(){var e,t,n;const o=null===(t=null===(e=g.value)||void 0===e?void 0:e.trim())||void 0===t?void 0:t.replace(/https?:/i,"").replace(/\//g,"");yield i.browserObj.storage.sync.set({apiDomain:o,apiKey:null===(n=b.value)||void 0===n?void 0:n.trim()}),yield i.browserObj.runtime.sendMessage({type:"getConfigFromBackend"}),y.style.display="none"})))),window.onblur=function(){var e,t,n;return o(this,void 0,void 0,(function*(){if(!d.apiDomain||!d.apiKey){const o=null===(t=null===(e=g.value)||void 0===e?void 0:e.trim())||void 0===t?void 0:t.replace(/https?:/i,"").replace(/\//g,"");yield i.browserObj.storage.sync.set({apiDomain:o,apiKey:null===(n=b.value)||void 0===n?void 0:n.trim()})}}))};const v=document.querySelector("#disableButton"),f=document.querySelector("#message");yield s(u,v,f),null===(a=document.getElementById("downloadLogsButton"))||void 0===a||a.addEventListener("click",(function(){return o(this,void 0,void 0,(function*(){yield i.browserObj.runtime.sendMessage({type:"saveLogs"})}))})),document.getElementById("clearLogsButton").addEventListener("click",(function(){return o(this,void 0,void 0,(function*(){yield i.browserObj.runtime.sendMessage({type:"clearLogs"}),document.getElementById("clearLogsMessage").style.display="block",setTimeout((()=>{document.getElementById("clearLogsMessage").style.display="none"}),3e3)}))}))}))))},427:function(e,t){var n,o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getDomain=t.getManagedSettings=t.isDomainMatched=t.getLogs=t.clearLogsInStorage=t.saveLogsToStorage=t.addLog=t.setBrowserName=t.browserName=t.browserObj=void 0,t.browserObj="undefined"==typeof browser?chrome:browser,t.browserName=function(){var e=navigator.userAgent.toLowerCase();if(navigator.brave||-1!==e.indexOf("brave"))return"Brave";if(-1!==e.indexOf("opera")||-1!==e.indexOf("opr"))return"Opera";if(-1!==e.indexOf("edge")||-1!==e.indexOf("edg/"))return"Edge";if(-1!==e.indexOf("whale"))return"Whale";if(-1!==e.indexOf("firefox"))return"Firefox";if(-1!==e.indexOf("vivaldi"))return"Vivaldi";if(-1!==e.indexOf("talon"))return"Talon";if(-1!==e.indexOf("island"))return"Island";if(-1!==e.indexOf("chrome"))return"Chrome";if(-1!==e.indexOf("safari"))return"Safari";return"Unknown"}(),"Whale"==t.browserName&&(t.browserObj.identity=null),t.setBrowserName=function(e){t.browserName=e},null!==(n=AbortSignal.timeout)&&void 0!==n||(AbortSignal.timeout=function(e){const t=new AbortController;return setTimeout((()=>t.abort()),e),t.signal});let i=[],r=[],s=Date.now();if("Safari"==t.browserName){const e=t.browserObj.storage.sync.set;t.browserObj.storage.sync.set=function(n){let o=[];for(const e in n)null===n[e]&&(o.push(e),delete n[e]);return o.length>0&&t.browserObj.storage.sync.remove(o),e.apply(t.browserObj.storage.sync,[n])}}const a=console.log;function l(e,t){return o(this,void 0,void 0,(function*(){const n=Date.now(),o=`${(new Date).toLocaleString()} - ${e.split(".")[0].padEnd(11)} ${t}`;a(o),i.push(o),r.push(o),i.length>1e3&&i.shift(),(n-s>=6e4||r.length>=50)&&(yield d())}))}function d(){return o(this,void 0,void 0,(function*(){r.length>0&&(yield t.browserObj.storage.local.set({debugLogs:i})),r=[],s=Date.now()}))}console.log=function(...e){let n="";const o=e.toString();try{const e=(new Error).stack.split("\n"),t=e[0].startsWith("Error")?e[2]:e[1];n=t.match(/\/[^/]+\/([^/]+:\d+):\d+/)[1]}catch(e){}if(location.toString().includes("background"))l(n,o);else{const e={type:"addLog",location:n,log:o};t.browserObj.runtime.sendMessage(e).catch((()=>{}))}},t.addLog=l,t.saveLogsToStorage=d,t.clearLogsInStorage=function(){return o(this,void 0,void 0,(function*(){i=[],yield t.browserObj.storage.local.set({debugLogs:i}),r=[],s=Date.now()}))},t.getLogs=function(){return o(this,void 0,void 0,(function*(){const{debugLogs:e}=yield t.browserObj.storage.local.get(["debugLogs"]);return i=e||[],i}))},t.isDomainMatched=function(e,t){for(const n of t)if(e==n||(null==e?void 0:e.endsWith("."+n)))return!0;return!1};let c,u=!1;function y(e){return o(this,void 0,void 0,(function*(){u||(yield function(){return o(this,void 0,void 0,(function*(){return new Promise((e=>{t.browserObj.runtime.sendNativeMessage("dummy.application.id",{type:"settings"},(function(t){c=t.settings,e(c)}))}))}))}(),u=!0);return Object.keys(c).filter((t=>e.includes(t))).reduce(((e,t)=>(e[t]=c[t],e)),{})}))}t.getManagedSettings=function(e){return o(this,void 0,void 0,(function*(){try{if("Safari"==t.browserName)return yield y(e);if(t.browserObj.storage.managed)return(yield t.browserObj.storage.managed.get(e))||{}}catch(e){console.log(e)}return{}}))},t.getDomain=function(e,t=void 0){let n="";try{e&&e.includes("://")&&(n=new URL(e).hostname,!0!==t||n.startsWith("www.")?!1===t&&n.startsWith("www.")&&(n=n.substring(4)):n="www."+n)}catch(e){console.log(e)}return n}}},t={};(function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports})(6)})();