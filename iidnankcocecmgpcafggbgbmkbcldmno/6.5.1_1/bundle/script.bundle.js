({813:function(){var t=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};if(void 0===n){function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>("x"===t?16*Math.random()|0:16*Math.random()&3|8).toString(16)))}var i=document.getElementById("ps_script");let A=null==i?void 0:i.src,U=null==i?void 0:i.dataset;var n=(null==U?void 0:U.ext_id)||(null==A?void 0:A.split("/")[2]),o="true"===(null==U?void 0:U.inspect_files),s="all"===(null==U?void 0:U.block_chat_sharing),r="true"===(null==U?void 0:U.inspect_responses),a="true"===(null==U?void 0:U.inspect_drive),l="true"===(null==U?void 0:U.block_chatgpt_training),c="true"===(null==U?void 0:U.block_chatgpt_memory),d=!1,h={},u={},p=[],f=e(),m=e(),g="",y="";function v(t){let e="";const i=t.toString();try{const t=(new Error).stack.split("\n"),i=t[0].startsWith("Error")?t[2]:t[1];e=i.match(/\/[^/]+\/([^/]+:\d+):\d+/)[1]}catch(t){}_(n,{message:"addLog",location:e,log:i}).catch((()=>{}))}function w(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x(t){let e=t;return""==t?e=location.href:t.startsWith("/")&&(e=`${location.protocol}//${location.hostname}${t}`),e}function b(t){return/[\u4E00-\u9FAF\u3400-\u4DBF]/.test(t)}function E(t,e){let i={},n=0;if(P(t))try{t=decodeURIComponent(t)}catch(t){}for(let o of Object.keys(e))try{const s=e[o];if(o=o.trim(),o.length<4&&!b(o))continue;if(t.includes(o)){i[o]=s;continue}let r=new RegExp(`(^|\\W|\\\\n|\\\\t)${w(o)}(\\W|$)`);if(r.test(t))i[o]=s;else{let e=JSON.stringify(o).slice(1,-1);r=new RegExp(`(^|\\W|\\\\n|\\\\t)${w(e)}(\\W|$)`),r.test(t)?(i[o]=s,n=1):(e=JSON.stringify(e).slice(1,-1),r=new RegExp(`(^|\\W|\\\\n|\\\\t)${w(e)}(\\W|$)`),r.test(t)&&(i[o]=s,n=2))}}catch(t){v(t.name)}return 0==Object.keys(i).length&&t.includes("+")?E(t.replaceAll("+"," "),e):[i,n]}function _(e,i){var n;return t(this,void 0,void 0,(function*(){return"undefined"!=typeof chrome&&(null===(n=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===n?void 0:n.sendMessage)?yield chrome.runtime.sendMessage(e,i):yield function(t){return new Promise((e=>{const i=Math.random().toString(36).substring(2)+Date.now().toString(36);window.addEventListener("message",(function t(n){n.source===window&&n.data&&"FROM_BACKGROUND"===n.data.type&&n.data.messageId===i&&(window.removeEventListener("message",t),e(n.data.response))})),window.postMessage({type:"FROM_PAGE",messageId:i,message:t},"*")}))}(i)}))}function q(i,o,s,r=!1){return t(this,void 0,void 0,(function*(){if(!(null==s?void 0:s.trim()))return s;let t={},a=!1;if(r?t[s]={type:"file",width:0}:[t,a]=E(s,Object.assign(Object.assign({},u),h)),0==Object.keys(t).length)return s;t=function(t){const e=Object.keys(t),i=e.filter((t=>!e.some((e=>e!==t&&e.includes(t))))),n={};return i.forEach((e=>{n[e]=t[e]})),n}(t),location.href.includes(g)||(f=e()),m=e(),g=location.href.split("?")[0];let l={message:"callProtectApi",text:s,userEnteredTexts:t,isJson:a,hookMethod:o,requestUrl:i,url:window.location.href,domain:window.location.hostname,title:document.title,isFile:r,conversationId:f,promptResponseId:m},c=yield _(n,l);c||(v(`Protect ${o} request to ${i} returned an empty response`),c=s);const d=c!=s;return v(`Protected ${o} request to ${i}, modified=${d}`),d&&(u=t),c}))}function O(e,i){var o,s;return t(this,void 0,void 0,(function*(){if(!i)return!1;if((location.href.startsWith("https://www.bing.com/search")||location.href.startsWith("https://chatgpt.com/")||location.href.startsWith("https://www.genspark.ai/api/search/stream"))&&(location.search.includes("q=")||location.search.includes("query=")))try{const t=new URLSearchParams(location.search),e=t.get("q")||t.get("query");e&&(h[e]={type:"query",width:0})}catch(t){}const[t]=E(i,Object.assign(Object.assign({},u),h));if(0==Object.keys(t).length)return!1;const r=Object.values(t);let a=yield _(n,{message:"callShouldInspectChat",url:e,body:i,pageUrl:window.location.href.split("?")[0],pageTitle:document.title,optionalFavicons:[`${null===(o=document.querySelector("link[rel='icon']"))||void 0===o?void 0:o.href}`,`${null===(s=document.querySelector("link[rel='shortcut icon']"))||void 0===s?void 0:s.href}`],inputTypes:r});return v(`Detected user input in the request body of ${e}, isChat=${a}, inputTypes=${JSON.stringify(r)}`),a}))}function S(e,i,o){return t(this,void 0,void 0,(function*(){try{let t="";const s=yield function(t){return new Promise(((e,i)=>{try{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>e(n.result),n.onerror=t=>i(t)}catch(t){i(t)}}))}(e);if(["text/plain","text/html","text/css","application/json","application/javascript",""].includes(e.type)){const e=atob(s.split(",")[1]),n=yield q(i,"xhr",e,!0);e!=n&&(t=n,e.includes("\r")&&(t=function(t){const e=[];for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);n<=127?e.push(n):e.push(42)}return new Uint8Array(e)}(t)))}else{let r={message:"callProtectFileApi",requestUrl:i,url:window.location.href,userEmail:y,text:"File upload",requestMethod:o,file_b64_url:s,file_name:e.name,domain:window.location.hostname};t=yield _(n,r)}return v(`Protected ${o} upload of file ${e.name} to ${i}, modified=${null!=t}`),t?new File([t],e.name,{type:e.type,lastModified:e.lastModified}):e}catch(t){return v(t),e}}))}function P(t){try{t.endsWith("&")&&(t=t.slice(0,-1));const e=t.split("&");for(let t=0;t<e.length;t++){const i=e[t].split("=");if(2!==i.length||!i[0]||!i[1])return!1}return!0}catch(t){return v(t),!1}}const W=()=>{let e=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(t,i){try{this._url=x(i.toString()),this._method=t}catch(t){v(`${i}, ${t}, ${t.stack}`)}e.apply(this,arguments)};let i=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e,s;return t(this,arguments,void 0,(function*(){let r=!1;try{const l=x(this._url),c=arguments[0];if(o&&c instanceof File&&"PUT"===this._method&&l.startsWith("https://files.oaiusercontent.com"))return arguments[0]=yield S(c,l,this._method),void i.apply(this,arguments);if(a&&"PUT"==this._method&&l.match("https://wt-prod-s3asaservice-storm.s3..*.amazonaws.com/.*")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"PUT"==this._method&&l.match("https://.*.s3..*.amazonaws.com/.*")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"POST"==this._method&&l.match("https://.*.sharefile.com/service/apiadapter/api/threadedupload.*")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"PUT"==this._method&&l.startsWith("https://api.onedrive.com/rup/")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"POST"===this._method&&l.match("https://cws.icloud-content.com.*/singleFileUpload")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"POST"===this._method&&l.includes(".dropbox.com/2/files/upload_session/")){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:null===(s=null===(e=document.cookie)||void 0===e?void 0:e.split("last_active_role=")[1])||void 0===s?void 0:s.split(";")[0],text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"PUT"===this._method&&(l.includes(".google.com/upload/drive/v2internal/files")||l.includes(".google.com/upload/drive/v2internal/batch"))){let t={message:"callProtectFileApi",requestUrl:l,url:window.location.href,userEmail:y,text:"File upload",requestMethod:this._method};return void((yield _(n,t))||i.apply(this,arguments))}if(a&&"GET"===this._method&&l.includes(".google.com/v1/account")){let e=this.onload;this.onload=function(){return t(this,arguments,void 0,(function*(){try{let t=JSON.parse(this.responseText);y=t[0][0][13]}catch(t){v(t)}finally{e&&e.apply(this,arguments)}}))}}else if(c instanceof FormData&&(yield O(l,[...c.values()].join(" ")))){let t=new FormData;for(let[e,i]of c.entries()){const n=yield q(l,"xhr",i);t.append(e,n)}arguments[0]=t,r=!0}else if(c instanceof Uint8Array){const t=new TextDecoder("utf-8").decode(c);if(yield O(l,t)){const e=yield q(l,"xhr",t);e&&e!=t&&(arguments[0]=(new TextEncoder).encode(e),r=!0)}}else if("string"==typeof c&&(yield O(l,c))){let t=null,e=new URLSearchParams("");if(P(c))try{e=new URLSearchParams(c)}catch(t){v(t)}let i=0;for(let t of e.values())t&&i++;if(i>0){v("urlencoded form-data detected in request body");let i=!1,n=[];for(let[t,o]of e.entries()){let e=yield q(l,"xhr",o);e!=o&&(i=!0),n.push([t,encodeURIComponent(e)])}t=c,i&&(t=n.map((t=>t.join("="))).join("&"))}else t=yield q(l,"xhr",c);t&&t!=c&&(arguments[0]=t,r=!0)}}catch(t){v(`${this._url}, ${t}, ${t.stack}`)}return r&&(v(`Sending modified request to ${this._url}`),this.addEventListener("error",(function(){v(`${this._url}, ${this.status}, ${this.statusText}`)}))),i.apply(this,arguments)}))}};function $(t){let e="";return t.split(/event:/).map((t=>t.trim())).filter((t=>t)).forEach((t=>{const i=t.match(/data:\s*(\{.*\}|\[DONE\])/);if(i){const t=i[1];if("[DONE]"===t)return;const n=JSON.parse(t);"patch"===n.o&&Array.isArray(n.v)?n.v.forEach((t=>{"/message/content/parts/0"===t.p&&"append"===t.o&&(e+=t.v)})):("append"===n.o&&"/message/content/parts/0"===n.p||n.v&&"string"==typeof n.v)&&(e+=n.v)}})),e}const L=()=>{let e=window.fetch;window.fetch=function(){var i,a;return t(this,arguments,void 0,(function*(){let d="",h=!1,u=!1;try{if(arguments[0]instanceof Request){if(d=x(arguments[0].url.toString()),arguments[0].body&&"GET"!=arguments[0].method){const t=yield arguments[0].clone().text();if(yield O(d,t)){const e=yield q(d,"fetch",t);e!=t&&(arguments[0]=new Request(arguments[0],{body:e}),h=!0)}}}else{d=x(arguments[0].toString());const t=arguments[1]&&arguments[1].body;if(s&&t&&d.startsWith("https://chatgpt.com/backend-api/share/"))return alert("ChatGPT sharing is blocked by your Administrator"),new Response(new Blob,{status:403,statusText:"Forbidden"});if(!t||t instanceof URLSearchParams||"{}"==t.trim()){let e=t instanceof URLSearchParams?t.toString():null!==(i=d.split("?")[1])&&void 0!==i?i:"",n=new URLSearchParams(e),o=0;for(let t of n.values())t&&o++;if(o>0&&(yield O(d,e))){let i=[];for(let[t,e]of n.entries()){const n=encodeURIComponent(yield q(d,"xhr",e));i.push([t,n])}const o=i.map((t=>t.join("="))).join("&");e!=o&&(t instanceof URLSearchParams?arguments[1]=new URLSearchParams(o):arguments[0]=d.split("?")[0]+"?"+o,h=!0)}}else if(t instanceof FormData&&((yield O(d,[...t.values()].join(" ")))||o&&d.startsWith("https://api.openai.com/v1/files"))){let e=new FormData;for(let[i,n]of t.entries())if(o&&n instanceof File&&d.startsWith("https://api.openai.com/v1/files")){let t=yield S(n,d,arguments[1].method);e.append(i,null!==(a=t)&&void 0!==a?a:n)}else{const t=yield q(d,"fetch",n);e.append(i,t)}arguments[1].body=e,h=!0}else if("string"==typeof t&&(yield O(d,t))){const e=yield q(d,"fetch",t);e!=t&&(arguments[1].body=e,h=!0),u="https://chatgpt.com/backend-api/conversation"==d,u&&v("Inspected ChatGPT request, modified="+h)}}}catch(t){v(`${d}, ${t}, ${t.stack}`)}return h&&v(`Sending modified request to ${d}`),e.apply(this,arguments).then((e=>t(this,arguments,void 0,(function*(){var i,o,s,a,h,p,g,y;try{if((l||c)&&d.startsWith("https://chatgpt.com/backend-api/settings/user")){const t=yield e.clone().json();let n=!1;if(l&&(null===(i=null==t?void 0:t.settings)||void 0===i?void 0:i.training_allowed)&&(null===(s=null===(o=arguments[1])||void 0===o?void 0:o.headers)||void 0===s?void 0:s.Authorization)&&(yield fetch("https://chatgpt.com/backend-api/settings/account_user_setting?feature=training_allowed&value=false",{method:"PATCH",headers:null===(a=arguments[1])||void 0===a?void 0:a.headers,body:"{}"}),t.settings.training_allowed=!1,n=!0),c&&(null===(h=null==t?void 0:t.settings)||void 0===h?void 0:h.sunshine)&&(null===(g=null===(p=arguments[1])||void 0===p?void 0:p.headers)||void 0===g?void 0:g.Authorization)&&(yield fetch("https://chatgpt.com/backend-api/settings/account_user_setting?feature=sunshine&value=false",{method:"PATCH",headers:null===(y=arguments[1])||void 0===y?void 0:y.headers,body:"{}"}),t.settings.sunshine=!1,n=!0),n)return new Response(JSON.stringify(t),{headers:e.headers,status:e.status,statusText:e.statusText})}if(r&&u)return function(e,i){return t(this,void 0,void 0,(function*(){const o=i.body.getReader(),s=new ReadableStream({start(i){return t(this,void 0,void 0,(function*(){let{done:t,value:s}=yield o.read(),r="";for(;!t;){i.enqueue(s);try{if(r+=(new TextDecoder).decode(s),r.trim().endsWith("data: [DONE]"))break}catch(t){}({done:t,value:s}=yield o.read())}i.close();try{let t={message:"callProtectApiForResponse",text:$(r),hookMethod:"fetch",requestUrl:e,url:window.location.href,domain:window.location.hostname,title:document.title,isFile:!1,conversationId:f,promptResponseId:m};yield _(n,t),v(`Sent log for ChatGPT response (${e})`)}catch(t){v(`Failed to parse ChatGPT response (${e})`)}}))}});return new Response(s,{headers:i.headers})}))}(d,e)}catch(t){}return e})))).catch((t=>{h&&v(`${d}, ${t}`)}))}))}},k=()=>{const e=WebSocket.prototype.send;WebSocket.prototype.send=function(i){return t(this,void 0,void 0,(function*(){this.wsMessageQueue||(this.wsMessageQueue=[]);const t={data:i,inspected:!1,modified:!1};this.wsMessageQueue.push(t);let n=!1,o=i;if("object"==typeof i&&"wss://mqtt.felo.ai/mqtt"==this.url)try{o=String.fromCharCode.apply(null,i),n=!0}catch(t){}if("string"==typeof o&&this.url&&(yield O(this.url,o)))try{let e=yield q(this.url,"ws",o);if(e!=o)if(n)try{t.data=new Uint8Array([...e].map((t=>t.charCodeAt(0)))),t.modified=!0}catch(t){}else t.data=e,t.modified=!0}catch(t){v(t)}for(t.inspected=!0;1==this.readyState&&this.wsMessageQueue.length>0&&this.wsMessageQueue[0].inspected;){const t=this.wsMessageQueue.shift();t.modified&&v(`Sending modified request to ${this.url}`),e.call(this,t.data)}}))}},j=()=>{let e=window.EventSource;window.EventSource=class{init(i,n){var o;return t(this,void 0,void 0,(function*(){this.created=!0;try{let t=x(i.toString()),e=null!==(o=t.split("?")[1])&&void 0!==o?o:"",n=new URLSearchParams(e),s=0;for(let t of n.values())t&&s++;if(s>0&&(yield O(t,e))){let i=[];for(let[e,o]of n.entries()){const n=encodeURIComponent(yield q(t,"xhr",o));i.push([e,n])}e=i.map((t=>t.join("="))).join("&"),this.url=t.split("?")[0]+"?"+e}}catch(t){v(t)}if(this.original=new e(this.url,n),this.appOnMessage&&(this.original.onmessage=this.appOnMessage),this.appOnError&&(this.original.onerror=this.appOnError),this.appOnOpen&&(this.original.onopen=this.appOnOpen),this.appEventListeners)for(let t of this.appEventListeners)addEventListener.apply(this.original,t)}))}constructor(e,i){var n;this.url=x(e.toString()),this.withCredentials=null!==(n=null==i?void 0:i.withCredentials)&&void 0!==n&&n,Object.defineProperty(this,"onmessage",{set:function(n){this.appOnMessage=function(e){return t(this,void 0,void 0,(function*(){n(e)}))},this.original&&(this.original.onmessage=this.appOnMessage),this.created||this.init(e,i)},get:function(){return this.appOnMessage},configurable:!0}),Object.defineProperty(this,"onerror",{set:function(t){this.appOnError=t,this.original&&(this.original.onerror=this.appOnError),this.created||this.init(e,i)},get:function(){return this.appOnError},configurable:!0}),Object.defineProperty(this,"onopen",{set:function(t){this.appOnOpen=t,this.original&&(this.original.onopen=this.appOnOpen),this.created||this.init(e,i)},get:function(){return this.appOnOpen},configurable:!0}),Object.defineProperty(this,"readyState",{get:function(){return null!=this.original?this.original.readyState:2}})}close(){this.original&&this.original.close()}addEventListener(e,i,n){return t(this,void 0,void 0,(function*(){this.created||(yield this.init(this.url,{withCredentials:this.withCredentials})),this.original?this.original.addEventListener(e,(function(e){return t(this,void 0,void 0,(function*(){i(e)}))}),n):(this.appEventListeners||(this.appEventListeners=[]),this.appEventListeners.push([e,i,n]))}))}}},C=()=>{try{W()}catch(t){v(t)}try{L()}catch(t){v(t)}try{k()}catch(t){v(t)}try{j()}catch(t){v(t)}v(`Monkey patch done for ${location.href}`)};function T(t,e){try{let i=function(t,e){let i=[],n=t.querySelectorAll(e);for(const t of n)""!==t.value&&i.push(t);return i}(t,e);return[...t.querySelectorAll("*")].filter((t=>t.shadowRoot)).forEach((t=>{i=i.concat(T(t.shadowRoot,e))})),i}catch(t){v(t)}return[]}function F(t){t.nodeType===Node.TEXT_NODE&&(h[t.nodeValue]={type:t.parentElement.type||t.parentElement.tagName,width:t.parentElement.offsetWidth});for(let e of t.childNodes)F(e)}function M(){for(let t of p){let e=t.value;e?"null"!=e&&"true"!=e&&"false"!=e&&"undefined"!=e&&(h[e]={type:t.type||t.tagName,width:t.offsetWidth}):F(t)}}function R(t){var e,i;try{d||(d=!0,C());const n=t.target;let o=[n];if(!n.value){let s=T(n,"textarea");if(0==s.length&&(s=T(n,"input")),0==s.length&&"paste"===t.type&&(null===(e=t.currentTarget)||void 0===e?void 0:e.activeElement)&&(s=[t.currentTarget.activeElement]),0==s.length&&t.data&&(null===(i=t.currentTarget)||void 0===i?void 0:i.activeElement)){const e=t.currentTarget.activeElement.value||t.currentTarget.activeElement.textContent;e&&e.endsWith(t.data)&&(s=[t.currentTarget.activeElement])}0==s.length&&(s=T(t.currentTarget,"textarea")),s.length>0&&(o=s)}for(let t of o)if(!p.includes(t)){if("text"===t.type&&t.form&&t.form.querySelectorAll('input[type="text"]').length>1)continue;if("password"===t.type||"email"===t.type||t.pattern)continue;if(t.getAttribute("inputmode")&&"text"!=t.getAttribute("inputmode")&&("search"!=t.getAttribute("inputmode")||!window.location.hostname.endsWith("glean.com")))continue;if(t.getAttribute("autocomplete")&&!t.getAttribute("autocomplete").endsWith("off")&&!t.getAttribute("autocomplete").endsWith("false"))continue;const e=parseInt(t.getAttribute("maxlength"));if(!isNaN(e)&&e<12)continue;p.push(t)}h={},M(),setTimeout(M,100)}catch(t){v(t)}}if(document.addEventListener("input",R,!0),document.addEventListener("paste",R,!0),"app.grammarly.com"==location.hostname){let N=setInterval((function(){const t=document.getElementsByTagName("iframe")[0];t&&t.contentWindow&&(t.contentWindow.document.addEventListener("input",R,!0),clearInterval(N))}),1e3)}if(location.href.startsWith("https://www.bing.com/images/create")||location.href.startsWith("https://copilot.microsoft.com/images/create")){const I=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){return t(this,void 0,void 0,(function*(){try{const t=new URL(this.action),e=t.searchParams;if(e.has("q")){const i=e.get("q"),n=yield q(this.action,"searchParams",i);e.set("q",n),t.search=e.toString(),this.action=t.toString()}const i=this.querySelector('[name="q"]');i&&(i.value=yield q(this.action,"form",i.value))}catch(t){v(t)}I.apply(this)}))}}("app.writer.com"==location.hostname||"www.bing.com"==location.hostname||"chatgpt.com"==location.hostname||"inference.cerebras.ai"==location.hostname||"www.vidu.studio"==location.hostname||"bot.ivy.ai"==location.hostname||"chat.lmsys.org"==location.hostname||location.hostname.endsWith("groq.com")||"zapier.com"==location.hostname||"platform.openai.com"==location.hostname||a&&("drive.google.com"==location.hostname||"www.dropbox.com"==location.hostname||"www.icloud.com"==location.hostname||"onedrive.live.com"==location.hostname||location.hostname.endsWith(".console.aws.amazon.com")||"wetransfer.com"==location.hostname||location.hostname.endsWith(".sharefile.eu")))&&(d||(d=!0,C()))}}})[813]();